# 数据库相关库

## 1.1 MyBatis-Plus

MyBatis-Plus 是一个 MyBatis 的增强工具，提供了代码生成、分页、逻辑删除等功能。

### 1.1.1 添加依赖

```xml
<dependency>
    <groupId>org.noear</groupId>
    <artifactId>solon.extend.mybatis-plus</artifactId>
    <version>2.7.6</version>
</dependency>
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.5.1</version>
</dependency>
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.0.28</version>
</dependency>
```

### 1.1.2 配置数据源

```yaml
db:
  url: jdbc:mysql://localhost:3306/test
  username: root
  password: 123456
  driverClassName: com.mysql.cj.jdbc.Driver
```

### 1.1.3 创建实体类

```java
import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;

@TableName("user")
public class User {
    @TableId(type = IdType.AUTO)
    private Long id;
    private String name;
    private Integer age;
    private String email;
    
    // getter、setter 方法
}
```

### 1.1.4 创建 Mapper 接口

```java
import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import org.noear.solon.annotation.Repository;

@Repository
public interface UserMapper extends BaseMapper<User> {
}
```

### 1.1.5 使用 Mapper

```java
import org.noear.solon.annotation.Component;
import org.noear.solon.annotation.Inject;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;

@Component
public class UserService {
    
    @Inject
    UserMapper userMapper;
    
    public Page<User> getUserList(int page, int size) {
        return userMapper.selectPage(new Page<>(page, size), null);
    }
    
    public User getUserById(Long id) {
        return userMapper.selectById(id);
    }
    
    public void addUser(User user) {
        userMapper.insert(user);
    }
    
    public void updateUser(User user) {
        userMapper.updateById(user);
    }
    
    public void deleteUser(Long id) {
        userMapper.deleteById(id);
    }
}
```

## 1.2 JPA

JPA (Java Persistence API) 是 Java EE 的持久化规范，Hibernate 是其最流行的实现。

### 1.2.1 添加依赖

```xml
<dependency>
    <groupId>org.noear</groupId>
    <artifactId>solon.extend.jpa</artifactId>
    <version>2.7.6</version>
</dependency>
<dependency>
    <groupId>org.hibernate</groupId>
    <artifactId>hibernate-core</artifactId>
    <version>5.6.10.Final</version>
</dependency>
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.0.28</version>
</dependency>
```

### 1.2.2 配置数据源和 JPA

```yaml
db:
  url: jdbc:mysql://localhost:3306/test
  username: root
  password: 123456
  driverClassName: com.mysql.cj.jdbc.Driver

jpa:
  hibernate:
    ddl-auto: update
  show-sql: true
```

### 1.2.3 创建实体类

```java
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.Table;

@Entity
@Table(name = "user")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;
    private Integer age;
    private String email;
    
    // getter、setter 方法
}
```

### 1.2.4 创建 Repository 接口

```java
import org.noear.solon.data.repository.CrudRepository;
import org.noear.solon.annotation.Repository;

@Repository
public interface UserRepository extends CrudRepository<User, Long> {
    User findByName(String name);
    List<User> findByAgeGreaterThan(Integer age);
}
```

### 1.2.5 使用 Repository

```java
import org.noear.solon.annotation.Component;
import org.noear.solon.annotation.Inject;

@Component
public class UserService {
    
    @Inject
    UserRepository userRepository;
    
    public List<User> getUserList() {
        return userRepository.findAll();
    }
    
    public User getUserById(Long id) {
        return userRepository.findById(id).orElse(null);
    }
    
    public User getUserByName(String name) {
        return userRepository.findByName(name);
    }
    
    public void addUser(User user) {
        userRepository.save(user);
    }
    
    public void updateUser(User user) {
        userRepository.save(user);
    }
    
    public void deleteUser(Long id) {
        userRepository.deleteById(id);
    }
}
```

## 1.3 Redis

Redis 是一个高性能的键值存储数据库，常用于缓存、会话管理等场景。

### 1.3.1 添加依赖

```xml
<dependency>
    <groupId>org.noear</groupId>
    <artifactId>solon.extend.redis</artifactId>
    <version>2.7.6</version>
</dependency>
<dependency>
    <groupId>redis.clients</groupId>
    <artifactId>jedis</artifactId>
    <version>3.8.0</version>
</dependency>
```

### 1.3.2 配置 Redis

```yaml
redis:
  host: localhost
  port: 6379
  password: 
  database: 0
```

### 1.3.3 使用 Redis

```java
import org.noear.solon.annotation.Component;
import org.noear.solon.data.redis.RedisClient;
import org.noear.solon.annotation.Inject;

@Component
public class RedisService {
    
    @Inject
    RedisClient redisClient;
    
    public void set(String key, String value) {
        redisClient.set(key, value);
    }
    
    public String get(String key) {
        return redisClient.get(key);
    }
    
    public void setex(String key, int seconds, String value) {
        redisClient.setex(key, seconds, value);
    }
    
    public void del(String key) {
        redisClient.del(key);
    }
    
    public boolean exists(String key) {
        return redisClient.exists(key);
    }
}
```
