# 消息队列相关库

## 3.1 RabbitMQ

RabbitMQ 是一个开源的消息代理软件，实现了高级消息队列协议 (AMQP)。

### 3.1.1 添加依赖

```xml
<dependency>
    <groupId>org.noear</groupId>
    <artifactId>solon.extend.rabbitmq</artifactId>
    <version>2.7.6</version>
</dependency>
<dependency>
    <groupId>com.rabbitmq</groupId>
    <artifactId>amqp-client</artifactId>
    <version>5.14.2</version>
</dependency>
```

### 3.1.2 配置 RabbitMQ

```yaml
rabbitmq:
  host: localhost
  port: 5672
  username: guest
  password: guest
  virtualHost: /
```

### 3.1.3 发送消息

```java
import org.noear.solon.annotation.Component;
import org.noear.solon.data.rabbitmq.RabbitTemplate;
import org.noear.solon.annotation.Inject;

@Component
public class MessageSender {
    
    @Inject
    RabbitTemplate rabbitTemplate;
    
    public void sendMessage(String queueName, String message) {
        rabbitTemplate.convertAndSend(queueName, message);
    }
    
    public void sendMessage(String exchange, String routingKey, Object message) {
        rabbitTemplate.convertAndSend(exchange, routingKey, message);
    }
}
```

### 3.1.4 接收消息

```java
import org.noear.solon.annotation.Component;
import org.noear.solon.data.rabbitmq.RabbitListener;
import org.noear.solon.data.rabbitmq.annotation.Queue;

@Component
public class MessageReceiver {
    
    @RabbitListener(queues = @Queue("test-queue"))
    public void receiveMessage(String message) {
        System.out.println("Received message: " + message);
    }
}
```

## 3.2 Kafka

Kafka 是一个分布式流处理平台，用于构建实时数据管道和流应用程序。

### 3.2.1 添加依赖

```xml
<dependency>
    <groupId>org.noear</groupId>
    <artifactId>solon.extend.kafka</artifactId>
    <version>2.7.6</version>
</dependency>
<dependency>
    <groupId>org.apache.kafka</groupId>
    <artifactId>kafka-clients</artifactId>
    <version>3.1.0</version>
</dependency>
```

### 3.2.2 配置 Kafka

```yaml
kafka:
  bootstrap-servers: localhost:9092
  producer:
    key-serializer: org.apache.kafka.common.serialization.StringSerializer
    value-serializer: org.apache.kafka.common.serialization.StringSerializer
  consumer:
    group-id: test-group
    key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
    value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
```

### 3.2.3 发送消息

```java
import org.noear.solon.annotation.Component;
import org.noear.solon.data.kafka.KafkaTemplate;
import org.noear.solon.annotation.Inject;

@Component
public class KafkaSender {
    
    @Inject
    KafkaTemplate kafkaTemplate;
    
    public void sendMessage(String topic, String message) {
        kafkaTemplate.send(topic, message);
    }
    
    public void sendMessage(String topic, String key, String message) {
        kafkaTemplate.send(topic, key, message);
    }
}
```

### 3.2.4 接收消息

```java
import org.noear.solon.annotation.Component;
import org.noear.solon.data.kafka.KafkaListener;
import org.noear.solon.data.kafka.annotation.Topic;

@Component
public class KafkaReceiver {
    
    @KafkaListener(topics = @Topic("test-topic"))
    public void receiveMessage(String message) {
        System.out.println("Received message: " + message);
    }
}
```
